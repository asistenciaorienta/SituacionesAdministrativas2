<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ASIM-SAE ‚Äî Aplicaci√≥n de soporte para la inscripci√≥n de migrantes</title>
  <style>
    :root{
      --sae-green:#007A33; /* verde institucional (ajustable) */
      --sae-green-dark:#1b5e20;
      --muted:#6b6b6b;
      --card-bg:#fff;
      --glass: rgba(255,255,255,0.9);
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    html, body {
      height: 100%;
      margin: 0;
    }
/* CENTRADO PAGINA INICIAL */
body{
  font-family: Arial, sans-serif;
  background:#f5f5f5;
  min-height:100vh;
  display:block; 
}

/* centrado solo del bloque inicial */
#pagina_inicial{
  width:100%;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

/* --- HEADER NUEVO --- */
header{
  width:100%;
  display:flex;
  align-items:center;
  justify-content:flex-start; /* logo a la izquierda */
  padding:6px 12px;
  position:absolute;
  top:0;
  left:0;
}

/* logo m√°s peque√±o */
header img{
  width:auto;
  height:60px;
  object-fit:contain;
  margin-left: 1rem;
}

/* t√≠tulo centrado arriba */
header h1{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  font-size:26px;
  text-align:center;
  width:100%;
  max-width:900px;
  margin-top:2rem;
  color: #007A33;
}

#nacionalidad-page{
  max-width:870px;
  background:white;
  border-radius:12px;
  box-shadow:0 2px 6px rgba(0,0,0,0.08);
  padding:30px 20px;
}
h2{
  font-size:20px;
  text-align:center;
}
    p.lead{margin:6px 0 0;color:var(--muted)}

    /* Botones principales */
    .cta-row{display:flex;gap:16px;margin:20px 0}
    .btn{padding:12px 18px;border-radius:10px;border:none;cursor:pointer;font-weight:600;box-shadow:0 6px 18px rgba(46,125,50,0.08)}
    .btn:active{transform:translateY(1px)}
    .btn-nocomunitario{background:var(--sae-green);color:#fff;min-width:220px;font-size:18px}

    /* Modal */
    
    .modal-backdrop{   
      text-align: center; /* centra el texto y botones dentro */   
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      position: fixed;      /* fijo en pantalla */
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5); /* fondo semi-transparente */
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;        /* muy alto para que est√© por encima de todo */
    }   
    .modal {
      background: var(--card-bg);
      border-radius: 12px;
      max-width: 720px;      
      padding: 18px;
      opacity: 0;
      transform: scale(.92);
      border-radius: 8px;
      max-width: 600px;
      width: 90%;
      max-height: 80%;
      overflow-y: auto;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      transition: transform 0.2s ease, opacity 0.2s ease;
    }
    
    .modal.show {
      opacity: 1;
      transform: scale(1);
    }    
    .modal h2{margin:0 0 8px}
    .modal .muted{color:var(--muted);font-size:14px}
    .modal .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:14px}

    /* Search UI */
.search-area{
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  margin:auto;
  width:100%;
  max-width:960px;
  display:none;
  background:white;
  padding:24px;
  overflow:auto;
  border-radius:0;
}
    
    .search-row{display:flex;gap:10px;align-items:center}
    input[type=text]{flex:1;padding:10px;border-radius:8px;border:1px solid #dfeee0}
    .small{font-size:13px;color:var(--muted)}

    /* Results */
    .results{margin-top:16px}
    .result-item{display:flex;gap:12px;align-items:flex-start;padding:10px;border-radius:8px;border:1px solid #e6efe7;background:white;margin-bottom:8px}
    .result-item .check{margin-top:2px}
    .result-item h3{margin:0;font-size:15px}
    .result-item p{margin:6px 0 0;color:var(--muted);font-size:13px}

    .details{margin-top:12px;padding:12px;border-radius:8px;background:#fff;border:1px solid #e6efe7}
    .field{display:flex;gap:8px;padding:6px 0}
    .field .label{width:180px;font-weight:600;color:var(--sae-green-dark);font-size:13px}
    .no-data{color:var(--muted);font-style:italic}

    footer{margin-top:22px;color:var(--muted);font-size:13px}

    /* Responsive */
    @media (max-width:600px){.cta-row{flex-direction:column}.btn-nocomunitario{min-width:unset;width:100%}}

.footer-logo {
  position: fixed;
  bottom: 0;
  left: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 10px 15px;
}

.footer-logo .logo-text {
  font-size: 14px;
  font-weight: bold;
  color: #007A33;
  left: 0;
}

.footer-logo img {
  height: 70px;
}

.footer-datos {
  position: fixed;
  bottom: 0;
  right: 0;
  background-color: #f5f5f5;
  color: #007A33;
  font-size: 14px;
  text-align: right;
  padding: 10px 15px;
  border-top-left-radius: 8px;
  box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.1);
}    
.btn-wrapper {
  position: relative;
  display: inline-block;
}

.tooltip-container {
  position: absolute;
  top: 15px;
  left: 18px;
}

.help-icon {
  background-color: #FFFFFF;
  color: #007A33;
  border-radius: 30%;
  width: 20px;
  height: 20px;
  font-size: 14px;
  font-weight: bold;
  text-align: center;
  line-height: 20px;
  cursor: pointer;
  z-index: 2;
  box-shadow: 0 1px 4px rgba(0,0,0,0.2);
}    

#modalNoComunitarioBackdrop {
  display:none;   /* ocultos desde inicio */
  position:fixed;
  top:0; left:0; right:0; bottom:0;
  justify-content:center;
  align-items:center;
  z-index:9999;
  inset:0;
  background: rgba(0,122,51,0.35); /* verde SAE con transparencia */
  backdrop-filter: blur(3px);
}    
#searchArea{
  display:flex;
  flex-direction:column;
  align-items:center;
  margin-top:30px;
  padding:25px;
}

.search-top{
  display:flex;
  flex-direction:column;
  width:100%;
  max-width:600px;
  gap:14px;
}

.search-top input{
  padding:12px 14px;
  border-radius:10px;
  border:1px solid #dfeee0;
  font-size:17px;
}

.search-top button{
  align-self:center;
  padding:12px 24px;
  font-size:18px;
}

.search-meta{
  width:100%;
  max-width:600px;
  display:flex;
  justify-content:space-between;
  margin-top:12px;
  color:var(--muted);
  font-size:14px;
}
.modal-detalle{
  padding:0;
  overflow:hidden;
  max-width:680px;
}

.modal-header-sae{
  background:var(--sae-green);
  color:white;
  padding:16px 22px;
  border-top-left-radius:12px;
  border-top-right-radius:12px;
}

.modal-header-sae h2{
  margin:0;
  font-size:20px;
}

.modal-body-sae{
  padding:20px 22px;
  color:#222;
  max-height:60vh;
  overflow-y:auto;
  font-size:15px;
  line-height:1.35;
}
.search-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 1em;
}

.search-intro {
  text-align: center;
  margin-bottom: 10px;
  font-size: 0.95em;
  color: #333;
}

.filters {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin-bottom: 10px;
}

.search-box {
  display: flex;
  justify-content: center;
  gap: 8px;
  width: 100%;
  max-width: 400px;
}

.search-box input {
  flex: 1;
  padding: 6px 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

.search-box button {
  padding: 6px 12px;
  border: none;
  background-color: #007f4f;
  color: white;
  border-radius: 8px;
  cursor: pointer;
}

.search-box button:hover {
  background-color: #005e3a;
}
    
  </style>
</head><body>
  <div class="container">
    <header>      
      <img src="/SituacionesAdministrativas/images/SAE_Junta_de_Andalucia_Documentacion.png" alt="Logo Junta de Andaluc√≠a" />
      <div>
        <h1>ASIM-SAE</h1>
        <h2>Aplicaci√≥n de soporte para la inscripci√≥n de migrantes</h2>
      </div>
    </header>

    <div class="search-container">
      <!-- üü© Texto introductorio -->
      <div class="search-intro">
        <p>Consulta SILA y marca lo que corresponda:</p>
      </div>
    
      <!-- üü© √Årea de filtros -->
      <div class="filters">
        <label><input type="checkbox" id="chkEntidad" checked> Consta una inscripci√≥n previa en SILA</label>
        <label><input type="checkbox" id="chkMunicipio" checked> Cobra prestaci√≥n o subsidio</label>
        <label><input type="checkbox" id="chkColectivo" checked> Nada de lo anterior</label>
      </div>

      <!-- √Årea de b√∫squeda -->
      <div id="searchArea" class="search-area" aria-live="polite" style="display:none;">
        <div class="search-top">
          <input id="searchInput" type="text" placeholder="Buscar por palabras‚Ä¶" disabled>
          <button id="btnSearch" class="btn btn-nocomunitario" disabled>Buscar</button>
        </div>
        <div class="search-meta">
          <span class="small">Opciones marcadas: <span id="estadoChecks" class="small no-data">ninguna</span></span>
          <span class="small">Resultados: <span id="countResults">0</span></span>
        </div>
        <div class="results" id="results"></div>
      </div>
      
    </div>
    
    <!-- MODAL DE DETALLES SELECCIONADO -->
    <div id="modalDetalle" class="modal-backdrop" style="display:none;">
      <div class="modal modal-detalle">
        <div class="modal-header-sae">
          <h2 id="modalDetalleTitulo">Detalles del registro seleccionado</h2>
        </div>
        <div class="modal-body-sae">
          <div id="modalDetalleContent"></div>
        </div>
        <div class="actions" style="justify-content:center;margin-top:20px; gap:20px">
          <button id="btnVolverDetalle" class="btn btn-comunitario" style="font-size:17px;padding:10px 26px">Volver</button>
          <button id="btnCerrarDetalle" class="btn btn-nocomunitario" style="font-size:17px;padding:10px 26px">Cerrar</button>
        </div>
      </div>
    </div>

    <footer>
      <div class="footer-logo">
        <div class="logo-text">Direcci√≥n Provincial de Granada</div>
      </div>
      <div class="footer-datos">
        <b>Apoyo durante la fase de testeo para la resoluci√≥n de dudas y la recogida de incidencias:</b><br>
        <hr>
        Versi√≥n 5.01<br>
        Elisabeth Huertas Garc√≠a &lt;<a href="mailto:elisabeth.huertas.garcia@juntadeandalucia.es">elisabeth.huertas.garcia@juntadeandalucia.es</a>&gt; ‚Äì 765145<br>
        Jos√© Manuel Robles Chaves &lt;<a href="mailto:josem.robles@juntadeandalucia.es">josem.robles@juntadeandalucia.es</a>&gt; ‚Äì 653467
      </div>
    </footer>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const chkInscrito = document.getElementById('chkInscrito');
  const chkPrestacion = document.getElementById('chkPrestacion');
  const chkNada = document.getElementById('chkNada');
  const estadoChecks = document.getElementById('estadoChecks');

  const paginaInicial = document.getElementById('pagina_inicial');
  const searchArea = document.getElementById('searchArea');
  const searchInput = document.getElementById('searchInput');
  const btnSearch = document.getElementById('btnSearch');
  const resultsEl = document.getElementById('results');
  const countResults = document.getElementById('countResults');
  const modalDetalle = document.getElementById('modalDetalle');
  const modalDetalleContent = document.getElementById('modalDetalleContent');
  const btnVolverDetalle = document.getElementById('btnVolverDetalle');
  const btnCerrarDetalle = document.getElementById('btnCerrarDetalle');

  let db = [];

  // --- cuando se marca o desmarca un check ---
  function actualizarChecks() {
    const activos = [];
    if (chkInscrito.checked) activos.push('Consta inscripci√≥n previa en SILA');
    if (chkPrestacion.checked) activos.push('Cobra prestaci√≥n o subsidio');
    if (chkNada.checked) activos.push('Nada de lo anterior');

    if (activos.length > 0) {
      estadoChecks.textContent = activos.join(', ');
      estadoChecks.classList.remove('no-data');
      searchInput.disabled = false;
      btnSearch.disabled = false;
      searchArea.style.display = 'flex';
    } else {
      estadoChecks.textContent = 'ninguna';
      estadoChecks.classList.add('no-data');
      searchInput.disabled = true;
      btnSearch.disabled = true;
      searchInput.value = '';
      resultsEl.innerHTML = '';
      countResults.textContent = '0';
    }
  }

  [chkInscrito, chkPrestacion, chkNada].forEach(chk => {
    chk.addEventListener('change', actualizarChecks);
  });

  // --- Carga inicial del JSON ---
  async function loadJSON(){
    try{
      const res = await fetch('./SituacionesAdministrativas.json', {cache:'no-store'});
      if(!res.ok) throw new Error('No se pudo cargar SituacionesAdministrativas.json');
      db = await res.json();
      console.log('Registros cargados:', db.length);
    }catch(err){
      console.error(err);
      resultsEl.innerHTML = `<div class="small" style="color:#c62828">Error al cargar JSON: ${err.message}</div>`;
    }
  }
  loadJSON();

  // --- L√≥gica de b√∫squeda (simplificada, la tuya original sirve igual) ---
  btnSearch.addEventListener('click', doSearch);
  searchInput.addEventListener('keydown', e => { if (e.key === 'Enter') doSearch(); });

  function normalize(s){
    if(s==null) return '';
    return String(s)
      .normalize('NFD')
      .replace(/\p{Diacritic}/gu,'')
      .replace(/[^\p{L}\p{N}]+/gu,' ')
      .toLowerCase()
      .trim();
  }

  function doSearch() {
    resultsEl.innerHTML = '';
    const q = searchInput.value.trim();
    if (!q) {
      resultsEl.innerHTML = '<div class="small">Escribe una o varias palabras para buscar.</div>';
      countResults.textContent = '0';
      return;
    }

    const tokens = q.toLowerCase().split(/\s+/).filter(Boolean);
    const matches = [];

    db.forEach((rec, idx) => {
      const anverso = normalize(rec['ANVERSO'] || '');
      const reverso = normalize(rec['REVERSO'] || '');
      const combined = `${anverso} ${reverso}`;
      let presentCount = 0;
      tokens.forEach(tok => { if (combined.includes(tok)) presentCount++; });
      if (tokens.length > 0 && (presentCount / tokens.length) >= 0.75) matches.push({ rec, idx });
    });

    if (matches.length === 0) {
      resultsEl.innerHTML = '<div class="small">No se han encontrado registros con el filtro aplicado.</div>';
      countResults.textContent = '0';
      return;
    }

    countResults.textContent = String(matches.length);
    matches.forEach(m => {
      const rec = m.rec;
      const wrapper = document.createElement('div');
      wrapper.className = 'result-item';
      const title = document.createElement('h3');
      title.textContent = (rec['ANVERSO'] || '').substring(0,120);
      const p = document.createElement('p');
      p.textContent = (rec['REVERSO'] || '').substring(0,220);
      wrapper.appendChild(title);
      wrapper.appendChild(p);
      wrapper.addEventListener('click', ()=>openModalDetalle(rec));
      resultsEl.appendChild(wrapper);
    });
  }

  function openModalDetalle(rec){
    modalDetalleContent.innerHTML = `
      <div class="field"><strong>Inscripci√≥n en SILA:</strong> ${rec["Inscripci√≥n en SILA"]||''}</div>
      <div class="field"><strong>¬øAutoriza a Trabajar?</strong> ${rec["¬øAutoriza a Trabajar?"]||''}</div>
      <div class="field"><strong>Tipo de Demanda:</strong> ${rec["Tipo de Demanda"]||''}</div>
      <div class="field"><strong>Observaciones:</strong> ${rec["Observaciones"]||''}</div>
      <div class="field"><strong>Documentaci√≥n:</strong> ${rec["Documentaci√≥n"]?`<a href="${rec["Documentaci√≥n"]}" target="_blank">Ver documento</a>`:''}</div>
    `;
    modalDetalle.style.display='flex';
  }

  btnVolverDetalle.addEventListener('click', ()=>{ modalDetalle.style.display='none'; });
  btnCerrarDetalle.addEventListener('click', ()=>{ modalDetalle.style.display='none'; });
});
</script>
</body>

</html>
